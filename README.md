# Eztrip后端

## 环境要求

- Python 3.8+
- 依赖库请参考 `requirements.txt`

## 安装

1. 创建虚拟环境并激活：
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/MacOS
   venv\Scripts\activate     # Windows
   ```

2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

## 配置

项目配置文件位于 `settings.py`，可根据需要修改以下内容：

- `SERVER_HOST`：服务运行的主机地址。
- `SERVER_PORT`：服务运行的端口。
## 运行

启动后端：

```shell
python main.py
```

<<<<<<< HEAD
## 测试
后端测试在对应的url后+/docs即可测试
eg：http://127.0.0.1:8000/docs
=======
## 二、系统应用场景分析（Scenario Analysis）

应用场景描述系统在现实使用过程中会发生的典型与异常情况，便于后续的用例建模与界面交互设计。

### 1. 典型场景

| 场景编号 | 场景名称             | 涉众      | 前置条件                         | 主要流程                                                                                                                                 | 后置条件                         |
|---:|---|---|---|---|---|
| T1 | 用户注册与登录       | 普通用户  | 用户访问平台首页                 | 1. 用户点击“注册”  2. 填写用户名、密码、邮箱等信息  3. 系统校验信息  4. 注册成功  5. 登录平台                                                    | 用户成功进入个人主页             |
| T2 | 创建行程             | 普通用户  | 用户已登录                       | 1. 点击“创建行程”  2. 输入行程名称、目的地、开始日期、结束日期  3. 保存行程                                                                      | 行程信息被记录并存储             |
| T3 | 编辑与复制行程       | 普通用户  | 用户已创建行程                   | 1. 选择行程  2. 点击“编辑”并修改信息并保存 / 或 点击“复制”生成副本                                                                              | 行程被修改或复制成功             |
| T4 | 大模型智能推荐行程   | 普通用户  | 用户已登录且授权使用 AI 行程生成 API | 1. 用户输入出行需求  2. 系统调用大模型 API  3. 返回智能行程建议  4. 用户可编辑并确认                                                              | 行程计划自动生成并可编辑         |
| T5 | 接收消息通知         | 普通用户  | 系统有公告或提醒                 | 1. 系统后台发送消息  2. 用户登录或通过消息中心查看  3. 消息展示                                                                                 | 用户接收到系统推送的信息         |
| T6 | 管理员发布公告/模板 | 管理员    | 管理员已登录后台系统             | 1. 管理员进入后台  2. 编辑公告/模板  3. 发布  4. 用户端实时更新                                                                                 | 公告/模板对所有用户可见         |
| T7 | 管理员查看用户信息   | 管理员    | 管理员已登录后台系统             | 1. 管理员进入用户管理  2. 查询用户信息（用户名、头像、密码）  3. 查看详情                                                                        | 管理员获得用户信息               |

### 2. 异常场景

| 场景编号 | 场景名称               | 涉众        | 异常触发条件                            | 系统应对措施                                           |
|---:|---|---|---|---|
| E1 | 登录失败               | 普通用户    | 用户输入错误的用户名或密码              | 提示“用户名或密码错误”，允许重试                     |
| E2 | 注册信息不合法         | 普通用户    | 用户输入空字段、重复用户名、不合法邮箱   | 提示错误信息并阻止注册                               |
| E3 | 行程创建失败           | 普通用户    | 网络中断、日期格式错误、目的地为空       | 显示错误提示，允许用户重新尝试                       |
| E4 | 大模型 API 生成失败   | 普通用户    | 网络中断或 API 服务异常                | 提示“行程生成失败，请稍后再试”                       |
| E5 | 管理员操作失败         | 管理员      | 后台公告/模板发布失败                   | 提示错误信息，并记录日志供技术支持排查               |
| E6 | 未授权访问             | 潜在用户    | 未登录用户访问需要登录的页面            | 跳转至登录/注册页面或弹出登录提示                   |
| E7 | 数据安全与隐私异常     | 管理员/用户 | 用户数据泄露或管理员误操作              | 启用日志记录、回滚机制并触发安全响应流程             |

---

# EzTrip 数据字典与数据流分析

## 一、数据项（Data Item）

| 数据项名 | 含义说明 | 别名 | 数据类型 | 长度 | 取值范围 | 取值含义 | 逻辑关系 |
|-----------|-----------|------|-----------|--------|-------------|--------------|--------------|
| user_id | 用户唯一编号 | 用户编号 | INT | 11 | 1~∞ | 系统自增用户标识 | 主键 |
| username | 用户名 | 登录名 | VARCHAR | 30 | 字母、数字、下划线 | 用户登录标识 | 唯一 |
| password | 登录密码 | 密码 | VARCHAR | 64 | 任意字符 | 用户身份验证凭据 | 与用户名一一对应 |
| avatar | 用户头像 | 头像路径 | VARCHAR | 255 | 图片 URL | 用户展示头像 | 可为空 |
| email | 用户邮箱 | 邮箱地址 | VARCHAR | 50 | 符合邮箱格式 | 用于验证与通知 | 唯一 |
| trip_id | 行程编号 | 行程 ID | INT | 11 | 1~∞ | 行程唯一标识 | 主键 |
| trip_name | 行程名称 | 行程标题 | VARCHAR | 100 | 任意字符 | 行程标识名 | 非空 |
| destination | 行程目的地 | 目的地 | VARCHAR | 50 | 任意地点名 | 用户计划去的地方 | 非空 |
| start_date | 行程开始日期 | 出发日期 | DATE | 10 | 合法日期 | 行程开始时间 | 必填 |
| end_date | 行程结束日期 | 结束日期 | DATE | 10 | 合法日期 | 行程结束时间 | 必填 |
| create_time | 行程创建时间 | 建立时间 | DATETIME | 19 | 系统时间戳 | 行程创建时间点 | 自动生成 |
| ai_plan | AI 生成行程内容 | 智能行程 | TEXT | 可变 | N/A | 系统生成的行程文本 | 可为空 |
| notice_id | 通知编号 | 公告 ID | INT | 11 | 1~∞ | 系统公告标识 | 主键 |
| notice_title | 公告标题 | 系统消息标题 | VARCHAR | 100 | 任意字符 | 公告主题 | 非空 |
| notice_content | 公告内容 | 公告正文 | TEXT | 可变 | 任意字符 | 系统通知信息 | 非空 |
| message_id | 消息编号 | 消息 ID | INT | 11 | 1~∞ | 系统消息标识 | 主键 |
| message_content | 消息内容 | 消息文本 | TEXT | 可变 | 任意字符 | 系统推送信息 | 可为空 |
| admin_id | 管理员编号 | 管理员 ID | INT | 11 | 1~∞ | 管理员唯一标识 | 主键 |
| template_id | 模板编号 | 攻略模板 ID | INT | 11 | 1~∞ | 模板唯一标识 | 主键 |
| template_content | 模板内容 | 行程模板 | TEXT | 可变 | 任意字符 | 管理员发布的行程攻略模板 | 非空 |

---

## 二、数据结构（Data Structure）

| 数据结构名 | 含义说明 | 组成 |
|--------------|------------|--------|
| 用户信息（User） | 存储用户注册登录相关数据 | user_id, username, password, email, avatar |
| 行程信息（Trip） | 用户创建的个人行程 | trip_id, user_id, trip_name, destination, start_date, end_date, ai_plan, create_time |
| 系统消息（Message） | 系统对用户推送的通知或公告 | message_id, user_id, message_content, create_time |
| 公告信息（Notice） | 管理员发布的系统公告 | notice_id, notice_title, notice_content, create_time |
| 模板信息（Template） | 管理员提供的行程模板 | template_id, template_content, create_time |
| 管理员信息（Admin） | 系统后台管理员账户 | admin_id, username, password |

---

## 三、数据流（Data Flow）

| 数据流名 | 说明 | 数据流来源 | 数据流去向 | 组成（数据结构） |
|------------|------------|--------------|-------------------|----------------|
| 用户注册信息流 | 用户注册时提交的个人信息 | 用户 | 用户注册处理模块 | 用户信息（User） |
| 登录验证流 | 用户登录提交的验证信息 | 用户 | 登录验证处理模块 | username, password |
| 行程创建流 | 用户创建行程时提交的信息 | 用户 | 行程管理处理模块 | 行程信息（Trip） |
| 行程编辑流 | 用户修改或复制行程 | 用户 | 行程管理处理模块 | Trip |
| 行程 AI 生成流 | 用户调用 AI 模型生成行程 | 用户 | AI 生成处理模块 | destination, start_date, end_date |
| 系统公告发布流 | 管理员发布公告 | 管理员 | 公告管理模块 | Notice |
| 模板发布流 | 管理员发布行程模板 | 管理员 | 模板管理模块 | Template |
| 系统消息通知流 | 系统向用户发送消息 | 系统 | 用户 | Message |
| 用户信息查询流 | 管理员查看用户信息 | 管理员 | 用户数据库 | User |

---

## 四、数据存储（Data Store）

| 数据存储名 | 说明 | 编号 | 流入的数据流 | 流出的数据流 | 组成 |
|--------------|------------|----------|----------------|----------------|---------|
| D1 用户数据存储 | 存放注册用户信息 | D1 | 用户注册信息流 | 用户信息查询流 | 用户信息（User） |
| D2 行程数据存储 | 存放用户创建的行程信息 | D2 | 行程创建流、行程编辑流、AI 生成流 | 行程展示流 | 行程信息（Trip） |
| D3 公告数据存储 | 存放系统公告 | D3 | 公告发布流 | 公告展示流 | 公告信息（Notice） |
| D4 模板数据存储 | 存放行程模板 | D4 | 模板发布流 | 模板浏览流 | 模板信息（Template） |
| D5 消息数据存储 | 存放系统推送的消息 | D5 | 系统消息通知流 | 消息展示流 | 系统消息（Message） |

---

## 五、处理过程（Processing）

| 处理过程名 | 说明 | 输入（数据流） | 输出（数据流） | 处理说明 |
|--------------|------------|-----------------|------------------|----------------|
| P1 用户注册处理 | 处理新用户注册信息 | 用户注册信息流 | 注册成功消息流 | 校验用户名唯一性、邮箱格式，存入用户数据库 |
| P2 用户登录验证 | 验证用户登录凭证 | 登录验证流 | 登录结果反馈流 | 核对用户名与密码，返回登录状态 |
| P3 行程管理处理 | 负责行程的创建、编辑、复制 | 行程创建流、行程编辑流 | 行程保存确认流 | 验证日期合法性并存储行程 |
| P4 行程 AI 生成处理 | 调用 AI 模型生成智能行程方案 | 行程 AI 生成流 | AI 生成结果流 | 调用内部 AI API，生成推荐行程并返回用户 |
| P5 公告管理处理 | 管理员发布或修改公告 | 公告发布流 | 公告展示流 | 将公告写入公告存储并广播通知 |
| P6 模板管理处理 | 管理员发布攻略模板 | 模板发布流 | 模板浏览流 | 保存模板到数据库供用户参考 |
| P7 消息通知处理 | 处理系统向用户推送的消息 | 系统消息通知流 | 用户接收消息流 | 将公告、系统提示推送至用户消息中心 |
| P8 用户信息管理处理 | 管理员查看用户信息 | 用户信息查询流 | 用户信息展示流 | 提供管理员后台用户查询接口 |

---

## 六、数据流关系简述

- 用户 → **P1 用户注册处理** → D1 用户数据存储  
- 用户 → **P2 登录验证** → D1 用户数据存储  
- 用户 ↔ **P3 行程管理处理** ↔ D2 行程数据存储  
- 用户 → **P4 行程 AI 生成处理** → D2 行程数据存储  
- 管理员 → **P5 公告管理处理** → D3 公告数据存储  
- 管理员 → **P6 模板管理处理** → D4 模板数据存储  
- 系统 → **P7 消息通知处理** → D5 消息数据存储 → 用户  
- 管理员 ↔ **P8 用户信息管理处理** ↔ D1 用户数据存储
>>>>>>> parent of d1414de (data)
